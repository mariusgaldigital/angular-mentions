!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("angular-mentions",["exports","@angular/common","@angular/core"],e):e(t["angular-mentions"]={},t.ng.common,t.ng.core)}(this,function(t,e,o){"use strict";function d(t){return p(t)?t.value:t.textContent}function f(t,e,i,n,o,r){if(void 0===r&&(r=!1),function h(t){return null!=t&&("INPUT"==t.nodeName||"TEXTAREA"==t.nodeName||"#text"==t.nodeName)}(t)){var s=d(t);!function c(t,e){p(t)?t.value=e:t.textContent=e}(t,s.substring(0,e)+n+s.substring(i,s.length)),m(t,e+n.length,o)}else if(!r){var a=u(o);if(a&&0<a.rangeCount){var l=a.getRangeAt(0).startOffset;f(a.anchorNode,l-(i-e),l,n,o,!0)}}}function p(t){return null!=t&&("INPUT"==t.nodeName||"TEXTAREA"==t.nodeName)}function m(t,e,i){if(void 0===i&&(i=null),p(t)&&t.selectionStart)t.focus(),t.setSelectionRange(e,e);else{var n=h(i).createRange();n.setStart(t,e),n.collapse(!0);var o=u(i);o.removeAllRanges(),o.addRange(n)}}function l(t,e){if(void 0===e&&(e=null),p(t))return t.value.slice(0,t.selectionStart).length;var i=u(e);if(0<i.rangeCount){var n=i.getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(t),o.setEnd(n.endContainer,n.endOffset),o.toString().length}}function h(t){return t?t.contentWindow.document:document}function u(t){return t?t.contentWindow.getSelection():window.getSelection()}function c(t){var e="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),i=h(t?t.iframe:null),n=u(t?t.iframe:null),o=n.getRangeAt(0),r=i.createRange();r.setStart(n.anchorNode,o.startOffset),r.setEnd(n.anchorNode,o.startOffset),r.collapse(!1);var s=i.createElement("span");s.id=e,s.appendChild(i.createTextNode("\ufeff")),r.insertNode(s),n.removeAllRanges(),n.addRange(o);var a={left:0,top:s.offsetHeight};return function l(t,e,i){var n=e,o=t?t.iframe:null;for(;n&&(null==t.parent||t.parent!=n);)i.left+=n.offsetLeft+n.clientLeft,i.top+=n.offsetTop+n.clientTop,!(n=n.offsetParent)&&o&&(n=o,o=null);n=e,o=t?t.iframe:null;for(;n!==h(null).body&&null!=n&&(null==t.parent||t.parent!=n);)n.scrollTop&&0<n.scrollTop&&(i.top-=n.scrollTop),n.scrollLeft&&0<n.scrollLeft&&(i.left-=n.scrollLeft),!(n=n.parentNode)&&o&&(n=o,o=null)}(t,s,a),s.parentNode.removeChild(s),a}var g=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],v="undefined"!=typeof window,y=v&&null!=window.mozInnerScreenX;var r=(i.prototype.ngOnInit=function(){this.itemTemplate||(this.itemTemplate=this.defaultItemTemplate)},i.prototype.position=function(t,e){if(void 0===e&&(e=null),p(t))this.coords=function d(t,e,i){if(!v)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var n=i&&i.debug||!1;if(n){var o=document.querySelector("#input-textarea-caret-position-mirror-div");o&&o.parentNode.removeChild(o)}var r=document.createElement("div");r.id="input-textarea-caret-position-mirror-div",document.body.appendChild(r);var s=r.style,a=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,l="INPUT"===t.nodeName;s.whiteSpace="pre-wrap",l||(s.wordWrap="break-word"),s.position="absolute",n||(s.visibility="hidden"),g.forEach(function(t){if(l&&"lineHeight"===t)if("border-box"===a.boxSizing){var e=parseInt(a.height),i=parseInt(a.paddingTop)+parseInt(a.paddingBottom)+parseInt(a.borderTopWidth)+parseInt(a.borderBottomWidth),n=i+parseInt(a.lineHeight);s.lineHeight=n<e?e-i+"px":e===n?a.lineHeight:"0"}else s.lineHeight=a.height;else s[t]=a[t]}),y?t.scrollHeight>parseInt(a.height)&&(s.overflowY="scroll"):s.overflow="hidden",r.textContent=t.value.substring(0,e),l&&(r.textContent=r.textContent.replace(/\s/g," "));var h=document.createElement("span");h.textContent=t.value.substring(e)||".",r.appendChild(h);var c={top:h.offsetTop+parseInt(a.borderTopWidth),left:h.offsetLeft+parseInt(a.borderLeftWidth),height:parseInt(a.lineHeight)};return n?h.style.backgroundColor="#aaa":document.body.removeChild(r),c}(t,t.selectionStart,null),this.coords.top=t.offsetTop+this.coords.top-t.scrollTop,this.coords.left=t.offsetLeft+this.coords.left-t.scrollLeft,this.offset=this.getBlockCursorDimensions(t).height;else if(e){var i={iframe:e,parent:e.offsetParent};this.coords=c(i)}else{var n=document.documentElement,o=(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0),r=(window.pageYOffset||n.scrollTop)-(n.clientTop||0),s=c({iframe:e}),a=t.getBoundingClientRect();this.coords.top=s.top-a.top+t.offsetTop-r,this.coords.left=s.left-a.left+t.offsetLeft-o}this.positionElement()},Object.defineProperty(i.prototype,"activeItem",{get:function(){return this.items[this.activeIndex]},enumerable:!0,configurable:!0}),i.prototype.activateNextItem=function(){var t=this.list.nativeElement,e=t.getElementsByClassName("active").item(0);if(e){var i=e.nextSibling;if(i&&"LI"==i.nodeName){var n=i.getBoundingClientRect();n.bottom>t.getBoundingClientRect().bottom&&(t.scrollTop=i.offsetTop+n.height-t.clientHeight)}}this.activeIndex=Math.max(Math.min(this.activeIndex+1,this.items.length-1),0)},i.prototype.activatePreviousItem=function(){var t=this.list.nativeElement,e=t.getElementsByClassName("active").item(0);if(e){var i=e.previousSibling;i&&"LI"==i.nodeName&&i.getBoundingClientRect().top<t.getBoundingClientRect().top&&(t.scrollTop=i.offsetTop)}this.activeIndex=Math.max(Math.min(this.activeIndex-1,this.items.length-1),0)},i.prototype.reset=function(){this.list.nativeElement.scrollTop=0,this.checkBounds()},i.prototype.checkBounds=function(){var t=this.coords.left,e=this.coords.top,i=this.dropUp,n=this.list.nativeElement.getBoundingClientRect();n.left+n.width>window.innerWidth&&(t=window.innerWidth-n.width-10),n.top<0&&(i=!1),this.positionElement(t,e,i)},i.prototype.positionElement=function(t,e,i){void 0===t&&(t=this.coords.left),void 0===e&&(e=this.coords.top),void 0===i&&(i=this.dropUp);var n=this.element.nativeElement;e+=i?0:this.offset,n.className=i?"dropup":null,n.style.position="absolute",n.style.left=t+"px",n.style.top=e+"px"},i.prototype.getBlockCursorDimensions=function(t){var e=window.getComputedStyle(t);return{height:parseFloat(e.lineHeight),width:parseFloat(e.fontSize)}},i.decorators=[{type:o.Component,args:[{selector:"mention-list",template:'\n    <ng-template #defaultItemTemplate let-item="item">\n      {{item[labelKey]}}\n    </ng-template>\n    <ul #list [hidden]="hidden" class="dropdown-menu scrollable-menu" [class.mention-menu]="!styleOff">\n      <li *ngFor="let item of items; let i = index" \n        [class.active]="activeIndex==i" [class.mention-active]="!styleOff && activeIndex==i">\n        <a class="dropdown-item" [class.mention-item]="!styleOff"\n          (mousedown)="activeIndex=i;itemClick.emit();$event.preventDefault()">\n          <ng-template [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{\'item\':item}"></ng-template>\n        </a>\n      </li>\n    </ul>\n    ',styles:[".mention-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:11em;padding:.5em 0;margin:.125em 0 0;font-size:1em;color:#212529;text-align:left;list-style:none;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:.25em}.mention-item{display:block;padding:.2em 1.5em;line-height:1.5em;clear:both;font-weight:400;color:#212529;text-align:inherit;white-space:nowrap;background-color:transparent;border:0}.mention-active>a{color:#fff;text-decoration:none;background-color:#337ab7;outline:0}.scrollable-menu{display:block;height:auto;max-height:292px;overflow:auto}[hidden]{display:none}"]}]}],i.ctorParameters=function(){return[{type:o.ElementRef}]},i.propDecorators={labelKey:[{type:o.Input}],itemTemplate:[{type:o.Input}],itemClick:[{type:o.Output}],list:[{type:o.ViewChild,args:["list"]}],defaultItemTemplate:[{type:o.ViewChild,args:["defaultItemTemplate"]}]},i);function i(t){this.element=t,this.labelKey="label",this.itemClick=new o.EventEmitter,this.items=[],this.activeIndex=0,this.hidden=!1,this.dropUp=!1,this.styleOff=!1,this.coords={top:0,left:0},this.offset=0}var n=(Object.defineProperty(s.prototype,"mention",{set:function(t){this.mentionItems=t},enumerable:!0,configurable:!0}),s.prototype.ngOnChanges=function(t){(t.mention||t.mentionConfig)&&this.updateConfig()},s.prototype.updateConfig=function(){var e=this,t=this.mentionConfig;this.triggerChars={},this.mentionItems&&(t.items=this.mentionItems),this.addConfig(t),t.mentions&&t.mentions.forEach(function(t){return e.addConfig(t)})},s.prototype.addConfig=function(i){var t=Object.assign({},this.DEFAULT_CONFIG),e=(i=Object.assign(t,i)).items;e&&0<e.length&&("string"==typeof e[0]&&(e=e.map(function(t){var e={};return e[i.labelKey]=t,e})),e=e.filter(function(t){return t[i.labelKey]}),i.disableSort||e.sort(function(t,e){return t[i.labelKey].localeCompare(e[i.labelKey])})),i.items=e,this.triggerChars[i.triggerChar]=i,this.activeConfig&&this.activeConfig.triggerChar==i.triggerChar&&(this.activeConfig=i,this.updateSearchList())},s.prototype.setIframe=function(t){this.iframe=t},s.prototype.stopEvent=function(t){t.wasClick||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())},s.prototype.blurHandler=function(t){this.stopEvent(t),this.stopSearch()},s.prototype.inputHandler=function(t,e){if(void 0===e&&(e=this._element.nativeElement),229===this.lastKeyCode&&t.data){var i=t.data.charCodeAt(0);this.keyDownHandler({keyCode:i,inputEvent:!0},e)}},s.prototype.keyPressHandler=function(t,e){if(void 0===e&&(e=this._element.nativeElement),this.lastKeyCode=t.keyCode,!t.isComposing&&229!==t.keyCode){var i=l(e,this.iframe),n=this.extractCharPressed(t,i),o=this.triggerChars[n];o&&(this.activeConfig=o,this.startPos=t.inputEvent?i-1:i,this.startNode=(this.iframe?this.iframe.contentWindow.getSelection():window.getSelection()).anchorNode,this.searching=!0,this.searchString=null,this.showSearchList(e),this.updateSearchList())}},s.prototype.keyDownHandler=function(t,e){void 0===e&&(e=this._element.nativeElement);var i=d(e),n=l(e,this.iframe),o=this.extractCharPressed(t,n);if(13==t.keyCode&&t.wasClick&&n<this.startPos&&(n=this.startNode.length,m(this.startNode,n,this.iframe)),0<=this.startPos&&this.searching)if(n<=this.startPos)this.searchList.hidden=!0;else if(16!==t.keyCode&&!t.metaKey&&!t.altKey&&!t.ctrlKey&&n>this.startPos){if(this.activeConfig.allowSpace||32!==t.keyCode){if(8===t.keyCode&&0<n)--n==this.startPos&&this.stopSearch();else if(!this.searchList.hidden){if(9===t.keyCode||13===t.keyCode){this.stopEvent(t);var r=this.activeConfig.mentionSelect(this.searchList.activeItem);if(f(e,this.startPos,n,r,this.iframe),"createEvent"in document){var s=document.createEvent("HTMLEvents");this.iframe?s.initEvent("change",!0,!1):s.initEvent("input",!0,!1),this._element.nativeElement.dispatchEvent(s)}return this.startPos=-1,this.stopSearch(),!1}if(27===t.keyCode)return this.stopEvent(t),this.stopSearch(),!1;if(40===t.keyCode)return this.stopEvent(t),this.searchList.activateNextItem(),!1;if(38===t.keyCode)return this.stopEvent(t),this.searchList.activatePreviousItem(),!1}}else this.startPos=-1;if(37===t.keyCode||39===t.keyCode)return this.stopEvent(t),!1;if(this.searching){var a=i.substring(this.startPos+1,n);8===t.keyCode||t.inputEvent||(a+=o),this.searchString=a,this.searchTerm.emit(this.searchString),this.updateSearchList()}}},s.prototype.stopSearch=function(){this.searchList&&(this.searchList.hidden=!0),this.activeConfig=null,this.searching=!1},s.prototype.updateSearchList=function(){var e=this,t=[];if(this.activeConfig&&this.activeConfig.items){var i=this.activeConfig.items;if(!this.activeConfig.disableSearch&&this.searchString){var n=this.searchString.toLowerCase();i=i.filter(function(t){return t[e.activeConfig.labelKey].toLowerCase().startsWith(n)})}t=i,0<this.activeConfig.maxItems&&(t=t.slice(0,this.activeConfig.maxItems))}this.searchList&&(this.searchList.items=t,this.searchList.hidden=0==t.length)},s.prototype.showSearchList=function(e){var i=this;if(null==this.searchList){var t=this._componentResolver.resolveComponentFactory(r),n=this._viewContainerRef.createComponent(t);this.searchList=n.instance,this.searchList.itemTemplate=this.mentionListTemplate,n.instance.itemClick.subscribe(function(){e.focus();var t={keyCode:13,wasClick:!0};i.keyDownHandler(t,e)})}this.searchList.labelKey=this.activeConfig.labelKey,this.searchList.dropUp=this.activeConfig.dropUp,this.searchList.styleOff=this.mentionConfig.disableStyle,this.searchList.activeIndex=0,this.searchList.position(e,this.iframe),window.setTimeout(function(){return i.searchList.reset()})},s.prototype.extractCharPressed=function(t,e){var i=t.key;if(!i){var n=t.which||t.keyCode;i=!t.shiftKey&&65<=n&&n<=90?String.fromCharCode(n+32):t.shiftKey&&2===n?this.DEFAULT_CONFIG.triggerChar:String.fromCharCode(t.which||t.keyCode)}return 13===t.keyCode&&t.wasClick&&e<this.startPos&&(e=this.startNode.length,m(this.startNode,e,this.iframe)),"q"===i&&t.altKey&&t.ctrlKey&&(i="@"),i},s.decorators=[{type:o.Directive,args:[{selector:"[mention], [mentionConfig]",host:{"(keydown)":"keyDownHandler($event)","(keypress)":"keyPressHandler($event)","(blur)":"blurHandler($event)",autocomplete:"off"}}]}],s.ctorParameters=function(){return[{type:o.ElementRef},{type:o.ComponentFactoryResolver},{type:o.ViewContainerRef}]},s.propDecorators={mention:[{type:o.Input,args:["mention"]}],mentionConfig:[{type:o.Input}],mentionListTemplate:[{type:o.Input}],searchTerm:[{type:o.Output}]},s);function s(t,e,i){var n=this;this._element=t,this._componentResolver=e,this._viewContainerRef=i,this.mentionConfig={items:[]},this.DEFAULT_CONFIG={items:[],triggerChar:"@",labelKey:"label",maxItems:-1,allowSpace:!1,mentionSelect:function(t){return n.activeConfig.triggerChar+t[n.activeConfig.labelKey]}},this.searchTerm=new o.EventEmitter,this.triggerChars={}}var a=(C.decorators=[{type:o.NgModule,args:[{declarations:[n,r],imports:[e.CommonModule],exports:[n],entryComponents:[r]}]}],C);function C(){}t.MentionDirective=n,t.MentionModule=a,t.ɵa=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-mentions.umd.min.js.map